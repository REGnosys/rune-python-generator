# This workflow runs Renovate Bot on a schedule or on demand.
# It uses the configuration file located at .github/renovate.json

name: Renovate
on:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
  # Runs the workflow on a schedule (e.g., every day at 2 AM)
  schedule:
    - cron: '0 2 * * *'

jobs:
  renovate:
    runs-on: ubuntu-latest
    # Grants the GITHUB_TOKEN the necessary permissions for Renovate to read repository content and create pull requests.
    permissions:
      contents: write
      pull-requests: write
    steps:
      # Checks out the repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v4
      # Runs the Renovate GitHub Action
      - name: Renovate
        # Using a slightly newer version of the action
        uses: renovatebot/github-action@v40.2.2
        with:
          # The token is required to create pull requests.
          token: ${{ secrets.GITHUB_TOKEN }}
          # Specifies the path to your Renovate configuration file.
          configurationFile: .github/renovate.json
        env:
          RENOVATE_REPOSITORIES: ${{ github.repository }} # This tells Renovate to scan the current repo
  # Add a build and test job that depends on renovate
  build_and_test:
    needs: renovate
    uses: ./.github/workflows/build-and-test-core.yml
